"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[14],{8786:(C,f,c)=>{c.d(f,{W:()=>R});var g=c(467),v=c(1626),u=c(4412),b=c(8810),d=c(8141),t=c(9437),y=c(7673),x=c(7468),U=c(6354);const o_URL="https://api.breezyemart.com/api/v1/";var m=c(3953),P=c(8490);let R=(()=>{var h;class I{constructor(e,s){this.http=e,this.storage=s,this.categories=[],this.address=[],this.laundriesByCategory=[],this.services=[],this.allLaundries=[],this.accessToken=new u.t(""),this.userId=new u.t(""),this.userProfileUpdated=new u.t(""),this.categoriesSubject=new u.t(this.categories),this.category$=this.categoriesSubject.asObservable(),this.addressSubject=new u.t(this.address),this.address$=this.addressSubject.asObservable(),this.laundriesByCategorySubject=new u.t([]),this.laundryByCategory$=this.laundriesByCategorySubject.asObservable(),this.servicesSubject=new u.t([]),this.allLaundriesSubject=new u.t([]),this.laundry$=this.allLaundriesSubject.asObservable(),this.init()}init(){var e=this;return(0,g.A)(function*(){let s=yield e.storage.get("accessToken"),n=yield e.storage.get("userId"),r=yield e.storage.get("profileUpdated");e.accessToken.next(s),e.userId.next(n),e.userProfileUpdated.next(r)})()}handleError(e){return console.error("An error occurred:",e.message),(0,b.$)("Something went wrong; please try again later.")}getUserId(){var e=this;return(0,g.A)(function*(){const s=yield e.storage.get("userId");if(s)return s;throw new Error("User Not Found in local Storgare")})()}register(e){return this.http.post(o_URL+"partner/register",e)}login(e){return this.http.post(o_URL+"user/login",e)}logout(){return this.http.get(o_URL+`user/logout?userId=${this.userId.value}`)}getUserProfile(){return this.http.get(o_URL+`user/get-current-user?userId=${this.userId.value}`)}updateUserProfile(e){return this.http.put(o_URL+`user/update-profile?userId=${this.userId.value}`,e)}getAllCategories(){this.http.get(o_URL+"partner/category/getAll").pipe((0,d.M)(e=>{console.log(e),this.categoriesSubject.next(e)}),(0,t.W)(this.handleError)).subscribe()}getAllAddress(){return this.http.get(o_URL+`user/get/all-address/${this.userId.value}`)}addUserAddress(e){return this.http.post(o_URL+`user/add-address?userId=${this.userId.value}`,e)}getUserAddress(){return this.http.get(o_URL+`user/get/all-address/${this.userId.value}`)}getLaundryByCategory(e,s,n,r){let i=(new v.Nl).set("categoryId","66a7496d1f27b4f5fb506c1d").set("userId",r).set("latitude",e).set("longitude",s);this.http.get(o_URL+"partner/shop/get-all",{params:i}).pipe((0,d.M)(l=>{console.log(l),this.laundriesByCategorySubject.next(l)}),(0,t.W)(this.handleError)).subscribe()}getServiceByLaundry(){let e=(new v.Nl).set("search","").set("latitude","18.5925785").set("longitude","73.7183639");this.http.get(o_URL+"partner/shop/get/by/category",{params:e}).pipe((0,d.M)(s=>{console.log(s),this.allLaundriesSubject.next(s)}),(0,t.W)(this.handleError)).subscribe()}getAllLaundries(){let e=(new v.Nl).set("search","").set("latitude","18.5925785").set("longitude","73.7183639");return this.http.get(o_URL+"partner/shop/get-all",{params:e})}getServiceByLaundryId(e){return this.http.get(o_URL+`partner/service/get/shopId/${e}`)}getAllOffers(){return this.http.get(o_URL+"admin/promoCode/get-all")}like(e){return this.http.post(o_URL+`partner/shop/like/${e}/${this.userId.value}`,{})}unlike(e){return this.http.post(o_URL+`partner/shop/unlike/${e}/${this.userId.value}`,{})}addToCart(e,s,n){return console.log(`Quantity added is in htttp ${s}`),this.http.post(o_URL+"cart/add",{userId:this.userId.value,quantity:s,serviceId:e,selectedQuantityType:n})}removeFromCart(e,s){return this.http.post(o_URL+"cart/remove",{userId:this.userId.value.toString(),quantity:s,serviceId:e})}fetchCartAndServices(e){const s=this.http.get(o_URL+`cart/${this.userId.value}`).pipe((0,t.W)(r=>(console.error("Cart fetch error:",r),(0,y.of)({data:{products:[]}})))),n=this.http.get(o_URL+`partner/service/get/shopId/${e}`).pipe((0,t.W)(r=>(console.error("Services fetch error:",r),(0,y.of)({data:{content:[]}}))));return(0,x.p)([s,n]).pipe((0,U.T)(([r,i])=>{const l=r.data.products||[];return(i.data.content||[]).map(L=>{const $=l.find(j=>j.serviceId._id===L._id);return{...L,quantity:$?$.quantity:0}})}))}getCart(){return this.http.get(o_URL+`cart/${this.userId.value}`)}checkout(e){return this.http.post(o_URL+"order/initiate/payment",{amount:e},{headers:{"x-access-token":this.accessToken.value.toString()}})}calculateCartAmount(e){return this.http.post(o_URL+"order/calculate/amount-to-pay",{userId:this.userId.value,code:e},{headers:{"x-access-token":this.accessToken.value}})}placeOrder(e,s,n,r,i,l,p,S){return this.http.post(o_URL+"order/place",{userId:this.userId.value,dropoffAddressId:e,pickupAddressId:s,pickupTime:n,dropoffTime:r,selfService:i,priceDetails:l,orderType:p,products:S})}getAllUserOrders(){return this.http.get(o_URL+`order/get/order/${this.userId.value}`)}getUserSubscription(){return this.http.get(o_URL+"subscription/get/all-plans")}getSubscriptionByUserId(){return this.http.get(o_URL+`subscription/get/${this.userId.value}`)}purchaseSubscription(e,s){return this.http.post(o_URL+"subscription/purchase",{userId:this.userId.value,planId:e,paymentDetails:s})}}return(h=I).\u0275fac=function(e){return new(e||h)(m.KVO(v.Qq),m.KVO(P.u))},h.\u0275prov=m.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),I})()},14:(C,f,c)=>{c.r(f),c.d(f,{SubscriptionsPageModule:()=>I});var g=c(177),v=c(9417),u=c(5374),b=c(5260),d=c(467),t=c(3953),y=c(8786),x=c(8490);function U(a,e){if(1&a&&(t.j41(0,"div",15,1)(2,"p"),t.EFF(3,"Best value"),t.k0s()()),2&a){const s=t.XpG().$implicit;t.AVh("active",3==s.validity)}}function o(a,e){if(1&a&&(t.j41(0,"div",10,0),t.DNE(2,U,4,2,"div",11),t.j41(3,"div",12)(4,"p"),t.EFF(5),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"currency"),t.k0s()(),t.j41(9,"div",13),t.nrm(10,"ion-radio",14),t.k0s()()),2&a){const s=e.$implicit,n=t.XpG();t.AVh("active",n.selectedPlanId===s._id),t.R7$(2),t.Y8G("ngIf",3==s.validity),t.R7$(3),t.JRh(s.name),t.R7$(2),t.Lme(" Only $",t.i5U(8,7,s.price,"INR")," for ",s.validity," months "),t.R7$(3),t.Y8G("value",s._id)}}const P=[{path:"",component:(()=>{var a;class e{constructor(n,r,i){this.logic=n,this.toastController=r,this.storage=i,this.selectedPlanId=""}ngOnInit(){}ionViewDidEnter(){this.getAllSubscriptions()}ionViewDidLeave(){}getAllSubscriptions(){var r,n=this;this.logic.getUserSubscription().subscribe({next:(r=(0,d.A)(function*(i){console.log(i),n.subs=i.data}),function(l){return r.apply(this,arguments)}),error:function(){var r=(0,d.A)(function*(i){console.log(i)});return function(l){return r.apply(this,arguments)}}()})}presentToast(){var n=this;return(0,d.A)(function*(){(yield n.toastController.create({message:"You have successfully purchased the subscription.",duration:2e3,animated:!0,mode:"ios"})).present()})()}purchase(){console.log(this.selectedPlanId),console.log(this.total),this.checkout()}radioButtonEvent(n){this.selectedPlanId=n.detail.value;const r=this.subs.find(i=>i._id===this.selectedPlanId);r&&(this.total=r.price,console.log("Selected Plan ID:",this.selectedPlanId),console.log("Selected Price:",this.total))}checkout(){var r,n=this;this.logic.checkout(this.total).subscribe({next:(r=(0,d.A)(function*(i){console.log(i.data.id),n.razorpayCheckput(i.data.id,i.data.amount)}),function(l){return r.apply(this,arguments)}),error:function(){var r=(0,d.A)(function*(i){console.log(i)});return function(l){return r.apply(this,arguments)}}()})}razorpayCheckput(n,r){var l=new Razorpay({key:"rzp_test_q92KbX0ZwFyaN0",amount:r,currency:"INR",name:"Breezy",description:"Test Transaction",image:"https://example.com/your_logo",order_id:n,handler:p=>{console.log("Payment Success"),this.createSubscription(n)},theme:{color:"#7e2faf"}});l.on("payment.failed",function(p){console.log("Payment Error")}),l.open()}getUserPurchasedSubscription(){var n;this.logic.getSubscriptionByUserId().subscribe({next:(n=(0,d.A)(function*(r){console.log(r)}),function(i){return n.apply(this,arguments)}),error:function(){var n=(0,d.A)(function*(r){console.log(r)});return function(i){return n.apply(this,arguments)}}()})}createSubscription(n){var l,r=this;this.logic.purchaseSubscription(this.selectedPlanId,`{paymentId: ${n},success: true}`.toString()).subscribe({next:(l=(0,d.A)(function*(p){console.log(p),r.presentToast(),r.getUserPurchasedSubscription()}),function(S){return l.apply(this,arguments)}),error:function(){var l=(0,d.A)(function*(p){console.log(p)});return function(S){return l.apply(this,arguments)}}()})}}return(a=e).\u0275fac=function(n){return new(n||a)(t.rXU(y.W),t.rXU(u.K_),t.rXU(x.u))},a.\u0275cmp=t.VBU({type:a,selectors:[["app-subscriptions"]],decls:12,vars:4,consts:[["first",""],["badge",""],["color","dark",1,"ion-no-border",3,"translucent"],["slot","start"],["defaultHref","/tabs/tabs/tab3"],[3,"fullscreen"],[1,"container-flex"],["name","auto",3,"ionChange","value"],["class","container",3,"active",4,"ngFor","ngForOf"],["color","primary","expand","block","fill","solid","mode","ios",3,"click"],[1,"container"],["class","badge",3,"active",4,"ngIf"],[1,"first"],[1,"last"],["mode","md",3,"value"],[1,"badge"]],template:function(n,r){1&n&&(t.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Subscription Plan"),t.k0s(),t.j41(4,"ion-buttons",3),t.nrm(5,"ion-back-button",4),t.k0s()()(),t.j41(6,"ion-content",5)(7,"div",6)(8,"ion-radio-group",7),t.bIt("ionChange",function(l){return r.radioButtonEvent(l)}),t.DNE(9,o,11,10,"div",8),t.k0s(),t.j41(10,"ion-button",9),t.bIt("click",function(){return r.purchase()}),t.EFF(11," Subscribe "),t.k0s()()()),2&n&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(2),t.Y8G("value",r.selectedPlanId),t.R7$(),t.Y8G("ngForOf",r.subs))},dependencies:[g.Sq,g.bT,u.Jm,u.QW,u.W9,u.eU,u.KO,u.f0,u.BC,u.ai,u.Je,u.el,g.oe],styles:["ion-content[_ngcontent-%COMP%]{--background: black}.container-flex[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:stretch;width:100%;height:100%;padding:20px}ion-radio[_ngcontent-%COMP%]{--color: var(--ion-color-light)}.container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:space-between;align-items:center;padding:20px;border:3px solid var(--ion-color-light);border-radius:20px;margin:10px 0;color:#fff;background:#000;height:100px;width:100%;transition:height .3s ease-out}.container.active[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:space-between;align-items:center;padding:20px;border:3px solid var(--ion-color-primary);border-radius:20px;margin:10px 0;color:#fff;background:#000;height:120px;width:100%;transition:height .3s ease-in}.badge[_ngcontent-%COMP%]{position:absolute;right:20px;top:-15px;height:30px;width:auto;border-radius:12px;background-color:#fff;color:#000;display:flex;justify-content:center;align-items:center;padding:0 10px}.badge.active[_ngcontent-%COMP%]{position:absolute;right:20px;top:-15px;height:30px;width:auto;border-radius:12px;background-color:var(--ion-color-primary);color:#fff;display:flex;justify-content:center;align-items:center;padding:0 10px}"]}),e})()}];let R=(()=>{var a;class e{}return(a=e).\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=t.G2t({imports:[b.iI.forChild(P),b.iI]}),e})();var h=c(541);let I=(()=>{var a;class e{}return(a=e).\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=t.G2t({imports:[g.MD,v.YN,u.bv,h.G,R]}),e})()}}]);