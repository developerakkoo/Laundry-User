<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-title>Cart</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" class="cart-info-btn">
        <ion-icon name="information-circle-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" *ngIf="products.length == 0">
  <div class="empty-cart-container">
    <div class="empty-cart-content">
      <img
        class="empty-cart-image"
        src="assets/empty-laundry.png"
        alt="Empty Cart"
      />
      <h2 class="empty-cart-title">Your cart is empty!</h2>
      <p class="empty-cart-subtitle">
        Start adding your laundry items to get started
      </p>
      <ion-button
        (click)="goToHome()"
        color="primary"
        expand="block"
        fill="solid"
        mode="ios"
        class="add-laundry-btn"
      >
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Go And Add Your Laundry now!
      </ion-button>
    </div>
  </div>
</ion-content>

<ion-content [fullscreen]="true" *ngIf="products.length > 0">
  <!-- Cart Items Section -->
  <div class="cart-section">
    <div class="section-header">
      <h3 class="section-title">Cart Items</h3>
      <span class="item-count">({{products.length}} Items)</span>
    </div>

    <div class="cart-items-container">
      <app-product-card
        *ngFor="let item of products"
        [productImageUrl]="item?.serviceId?.image_url"
        [productName]="item?.serviceId?.name"
        [quantityAcceptedIn]="item?.selectedQuantityType"
        [quantity]="item?.quantity"
        [desc]="item?.serviceId?.description"
        (quantityEvent)="addItem($event)"
        (quantityEventRemove)="deleteItem($event)"
        [_id]="item?.serviceId?._id"
        [productPricePerKg]="item?.serviceId?.perKgPrice"
        [productPricePerPiece]="item?.serviceId?.perPeacePrice"
      >
      </app-product-card>
    </div>
  </div>

  <!-- Shipping Details Section -->
  <div class="info-section">
    <div class="section-header">
      <h3 class="section-title">Shipping Details</h3>
      <ion-chip
        color="primary"
        mode="ios"
        outline="true"
        class="select-chip"
        (click)="openModalAddress()"
      >
        <ion-icon name="location-outline" slot="start"></ion-icon>
        <ion-label>Select</ion-label>
      </ion-chip>
    </div>

    <div class="info-content">
      <div class="info-item">
        <ion-icon name="location" class="info-icon"></ion-icon>
        <div class="info-details">
          <p class="info-label">Delivery To:</p>
          <p class="info-value">{{address?.address | titlecase}}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Offers Section -->
  <div class="info-section">
    <div class="section-header">
      <h3 class="section-title">Offers & Coupons</h3>
      <ion-chip
        *ngIf="!isPromoCodeApplied"
        color="primary"
        mode="ios"
        outline="true"
        class="apply-chip"
        (click)="applyOffer()"
        [disabled]="offerFirst.length == 0"
      >
        <ion-icon name="pricetag-outline" slot="start"></ion-icon>
        <ion-label>Apply</ion-label>
      </ion-chip>

      <ion-chip
        *ngIf="isPromoCodeApplied"
        color="danger"
        mode="ios"
        outline="true"
        class="remove-chip"
        (click)="removeOffer()"
        [disabled]="offerFirst.length == 0"
      >
        <ion-icon name="close-circle-outline" slot="start"></ion-icon>
        <ion-label>Remove</ion-label>
      </ion-chip>
    </div>

    <div class="info-content">
      <div class="info-item" *ngIf="offerFirst.length == 0">
        <ion-icon
          name="information-circle"
          class="info-icon warning"
        ></ion-icon>
        <div class="info-details">
          <p class="info-label">No offers available</p>
          <p class="info-value">You have no offers currently!</p>
        </div>
      </div>

      <div class="info-item" *ngIf="offerFirst.length > 0">
        <ion-icon name="pricetag" class="info-icon success"></ion-icon>
        <div class="info-details">
          <p class="info-label" *ngIf="!isPromoCodeApplied">
            Save {{offerFirst[0]['discountAmount'] | currency:"INR"}} with
            '{{offerFirst[0]['code']}}'
          </p>
          <p class="info-label success" *ngIf="isPromoCodeApplied">
            You have saved {{offerFirst[0]['discountAmount'] | currency:"INR"}}
            with '{{offerFirst[0]['code']}}'
          </p>
        </div>
      </div>

      <div
        class="view-all-offers"
        [routerLink]="['/offers']"
        routerLinkActive="router-link-active"
      >
        <ion-icon name="arrow-forward-outline"></ion-icon>
        <span>View all coupons</span>
      </div>
    </div>
  </div>

  <!-- Order Summary Section -->
  <div class="order-summary-section">
    <div class="section-header">
      <h3 class="section-title">Order Summary</h3>
    </div>

    <div class="order-summary-content">
      <div class="summary-item">
        <span class="summary-label">Subtotal</span>
        <span class="summary-value">{{subtotal | currency:"INR"}}</span>
      </div>

      <div class="summary-item">
        <span class="summary-label">Delivery</span>
        <span class="summary-value">{{deliveryCharges | currency:"INR"}}</span>
      </div>

      <div class="summary-item">
        <span class="summary-label">Handling Fees</span>
        <span class="summary-value">{{handlingFeed}}%</span>
      </div>

      <div class="summary-item" *ngIf="gstCharges > 0">
        <span class="summary-label">GST</span>
        <span class="summary-value">{{gstCharges | currency:"INR"}}</span>
      </div>

      <div class="summary-divider"></div>

      <div class="summary-item total">
        <span class="summary-label">Total</span>
        <span class="summary-value">{{total | currency:"INR"}}</span>
      </div>
    </div>
  </div>

  <!-- Confetti Canvas -->
  <canvas id="confetti-canvas"></canvas>

  <!-- Promo Code Success Modal -->
  <ion-modal
    id="example-modal"
    #modal
    [animated]="true"
    [isOpen]="isPromoCodeSuccessDialogOpen"
  >
    <ng-template>
      <div class="modal-container">
        <img src="assets/icon/balloons.gif" alt="Celebration" />
        <p class="applied">'{{offerFirst[0]['code']}}' applied</p>
        <p class="title">
          You Saved {{offerFirst[0]['discountAmount'] | currency:"INR"}}
        </p>
        <p class="label">with this coupon code.</p>
      </div>
    </ng-template>
  </ion-modal>
</ion-content>

<!-- Footer with Checkout Button -->
<ion-footer class="checkout-footer" *ngIf="products.length > 0">
  <ion-toolbar>
    <ion-button
      color="primary"
      (click)="presentActionSheet()"
      expand="block"
      fill="solid"
      shape="round"
      class="checkout-button"
    >
      <ion-icon name="card-outline" slot="start"></ion-icon>
      Proceed to Checkout
      <ion-icon
        slot="end"
        name="arrow-forward-outline"
        class="arrow-icon"
      ></ion-icon>
    </ion-button>

    <div class="total-display">
      <span class="total-label">Total Amount:</span>
      <span class="total-amount">{{total | currency:"INR"}}</span>
    </div>
  </ion-toolbar>
</ion-footer>
