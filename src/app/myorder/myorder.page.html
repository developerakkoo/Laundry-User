<ion-header [translucent]="true" class="ion-no-border premium-header">
  <ion-toolbar class="premium-toolbar">
    <ion-title class="premium-title">My Orders</ion-title>
    <ion-buttons slot="start">
      <ion-back-button
        defaultHref="/tabs/tabs/tab3"
        class="premium-back-button"
      ></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="premium-content">
  <!-- Premium Segment Control -->
  <div class="segment-container">
    <ion-segment
      value="1"
      (ionChange)="segmentChanged($event)"
      class="premium-segment"
    >
      <ion-segment-button value="1" class="segment-button">
        <ion-label>Recent</ion-label>
      </ion-segment-button>
      <ion-segment-button value="7" class="segment-button">
        <ion-label>Previous</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Premium Orders List -->
  <div class="orders-container">
    <ion-accordion-group class="premium-accordion-group">
      <ion-accordion
        class="premium-accordion animate__animated animate__backInLeft"
        *ngFor="let item of orders"
      >
        <!-- Premium Order Header -->
        <ion-item
          slot="header"
          lines="none"
          class="order-header premium-order-header"
          detail
        >
          <div class="order-thumbnail-container">
            <img
              class="order-thumbnail"
              crossorigin="anonymous"
              src="assets/washing.gif"
            />
            <div class="thumbnail-overlay"></div>
          </div>

          <div class="order-info-container">
            <div class="order-main-info">
              <h3 class="order-id">{{item.orderId}}</h3>
              <p class="order-items-count">{{item.items.length}} Items</p>
            </div>

            <div class="order-date">
              <ion-icon name="calendar-outline" class="date-icon"></ion-icon>
              <span class="date-text"
                >{{item.createdAt | date:"shortDate"}}</span
              >
            </div>

            <div class="order-status-badge" [ngClass]="'status-' + item.status">
              <ion-icon
                name="time-outline"
                class="status-icon"
                *ngIf="item.status === 0"
              ></ion-icon>
              <ion-icon
                name="checkmark-circle-outline"
                class="status-icon"
                *ngIf="item.status === 1"
              ></ion-icon>
              <ion-icon
                name="bicycle-outline"
                class="status-icon"
                *ngIf="item.status === 2"
              ></ion-icon>
              <ion-icon
                name="bag-outline"
                class="status-icon"
                *ngIf="item.status === 3"
              ></ion-icon>
              <ion-icon
                name="sync-outline"
                class="status-icon"
                *ngIf="item.status === 4"
              ></ion-icon>
              <ion-icon
                name="checkmark-done-outline"
                class="status-icon"
                *ngIf="item.status === 5"
              ></ion-icon>
              <ion-icon
                name="car-outline"
                class="status-icon"
                *ngIf="item.status === 6"
              ></ion-icon>
              <ion-icon
                name="home-outline"
                class="status-icon"
                *ngIf="item.status === 7"
              ></ion-icon>
              <span class="status-text">
                <span *ngIf="item.status === 0">Pending</span>
                <span *ngIf="item.status === 1">Confirmed</span>
                <span *ngIf="item.status === 2">Pickup Started</span>
                <span *ngIf="item.status === 3">Order Picked Up</span>
                <span *ngIf="item.status === 4">In Process</span>
                <span *ngIf="item.status === 5">Ready For Delivery</span>
                <span *ngIf="item.status === 6">Delivery Started</span>
                <span *ngIf="item.status === 7">Order Delivered</span>
              </span>
            </div>
          </div>
        </ion-item>

        <!-- Premium Order Content -->
        <div class="order-content" slot="content">
          <!-- Order Details Header -->
          <div class="order-details-header">
            <ion-icon name="receipt-outline" class="details-icon"></ion-icon>
            <h3 class="details-title">Your Order Details</h3>
          </div>

          <!-- Order Items List -->
          <div class="order-items-list">
            <div
              class="order-item premium-order-item"
              *ngFor="let i of item.items"
            >
              <div class="item-thumbnail-container">
                <img
                  class="item-thumbnail"
                  crossorigin="anonymous"
                  [src]="i.serviceId.image_url"
                />
                <div class="item-overlay"></div>
              </div>

              <div class="item-info-container">
                <h4 class="item-name">{{i.serviceId.name}}</h4>
                <p class="item-price">
                  {{i.serviceId.perKgPrice | currency:"INR"}}
                </p>
                <span class="item-quantity">Ã— {{i.quantity}}</span>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div class="order-summary">
            <div class="summary-header">
              <ion-icon
                name="calculator-outline"
                class="summary-icon"
              ></ion-icon>
              <h4 class="summary-title">Order Summary</h4>
            </div>

            <div class="summary-item">
              <span class="summary-label">Subtotal</span>
              <span class="summary-value"
                >{{item.priceDetails.subtotal | currency:"INR"}}</span
              >
            </div>

            <div class="summary-item">
              <span class="summary-label">Delivery</span>
              <span class="summary-value"
                >{{item.priceDetails.deliveryCharges | currency:"INR"}}</span
              >
            </div>

            <div class="summary-item">
              <span class="summary-label">Handling Fees</span>
              <span class="summary-value"
                >{{item.priceDetails.platformFee | currency:"INR"}}</span
              >
            </div>

            <div class="summary-item">
              <span class="summary-label">GST</span>
              <span class="summary-value"
                >{{item.priceDetails.gstAmount | currency:"INR"}}</span
              >
            </div>

            <div class="summary-total">
              <span class="total-label">Total</span>
              <span class="total-value"
                >{{item.priceDetails.totalAmountToPay | currency:"INR"}}</span
              >
            </div>
          </div>

          <!-- Rating Section for Completed Orders -->
          <div
            *ngIf="isOrderCompleted(item) && !isOrderRated(item)"
            class="rating-section"
            (click)="openRatingDialog(item._id, item.shopId)"
          >
            <div class="rating-header">
              <ion-icon name="star-outline" class="rating-icon"></ion-icon>
              <h4 class="rating-title">Rate Your Experience</h4>
              <p class="rating-subtitle">
                How was your laundry service experience?
              </p>
            </div>

            <!-- Star Rating -->
            <div class="star-rating-container">
              <div class="stars-wrapper">
                <ion-icon
                  *ngFor="let star of getRatingStars(5)"
                  [name]="star <= selectedRating ? 'star' : 'star-outline'"
                  class="star-icon"
                  [class.filled]="star <= selectedRating"
                  [class.hover]="star <= selectedRating"
                  (click)="setRating(star); $event.stopPropagation()"
                ></ion-icon>
              </div>
              <p class="rating-text" *ngIf="selectedRating > 0">
                {{ getRatingText(selectedRating) }}
              </p>
            </div>

            <!-- Rating Comment -->
            <div class="rating-comment-container">
              <ion-textarea
                placeholder="Share your experience (optional)"
                class="rating-comment"
                rows="3"
                maxlength="200"
                [value]="ratingComment"
                (ionInput)="onCommentInput($event); $event.stopPropagation()"
                (click)="$event.stopPropagation()"
              ></ion-textarea>
              <div class="comment-counter">{{ ratingComment.length }}/200</div>
            </div>

            <!-- Submit Rating Button -->
            <div class="rating-submit-container">
              <ion-button
                expand="block"
                fill="solid"
                shape="round"
                class="rating-submit-button"
                (click)="submitRating(); $event.stopPropagation()"
                [disabled]="selectedRating === 0"
              >
                <ion-icon name="send-outline" slot="start"></ion-icon>
                Submit Rating
              </ion-button>
            </div>
          </div>

          <!-- Already Rated Message -->
          <div
            *ngIf="isOrderCompleted(item) && isOrderRated(item)"
            class="already-rated-section"
          >
            <div class="rated-content">
              <ion-icon name="checkmark-circle" class="rated-icon"></ion-icon>
              <h4 class="rated-title">Thank You!</h4>
              <p class="rated-message">
                You've already rated this order. We appreciate your feedback!
              </p>
            </div>
          </div>

          <!-- Help Button -->
          <div class="help-button-container">
            <ion-button
              expand="block"
              fill="outline"
              shape="round"
              class="help-button"
            >
              <ion-icon name="help-circle-outline" slot="start"></ion-icon>
              Need Help?
            </ion-button>
          </div>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </div>
</ion-content>
